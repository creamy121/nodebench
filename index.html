<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Node.js Benchmark Results</title>
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-html5-1.6.1/r-2.2.3/sl-1.3.1/datatables.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://bootswatch.com/4/spacelab/bootstrap.min.css"/>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-html5-1.6.1/r-2.2.3/sl-1.3.1/datatables.min.js"></script>
    <script src="js/ttest.js"></script>
    <script src="js/main.js"></script>
    <script>
      var index = {"nodejs~node":{"master":{"2020":{"02":{"03_222625110-d435dc47f3d303ff1669fa711a0af287a9df973a":0,"04_231443831-018c3e8949e925efc8077801d44c2b2feb974750":0,"05_220338705-7e911d8b03a838e5ac6bb06c5b313533e89673ef":0,"07_023036815-d213f21c72f77da6f66f2723b300da27740a0a90":0,"08_012209845-f3682102dca1d24959e93de918fbb583f19ee688":0,"09_021408255-93c4c1a273736027439d087b0a52aa33df6a2b13":0,"10_015047564-d0413ae8f92aa0591506ff115f21ec0ae2591e62":0,"10_232715134-5b0308cd823a511098dadf9ddd5a35e3a9dbb424":0,"11_200324814-9fdb6e6aaf45b2364bac89a8f240772f49503ee6":0,"12_171710624-e23b12e130e2a16d518754cbbd7c333b82ae2361":0,"13_143435084-3e9302b2b34ab0309de8eda45c17efc8fd9cc2f5":0,"14_115048793-087583741716969edf12874d4f1f1774de581f50":0,"15_100634823-79296dc2d02c0b9872bbfcbb89148ea036a546d0":0,"16_085656533-a7c523e26df468782691c7e16b2e033c6256beb3":0,"17_085526944-4c746a6cfda980c1cd0de6246781c0083d9e416c":0,"18_054218334-af19f4116c5c3ce0fc7b18b62ffb05e8138bf74b":0,"19_021532293-7c524fb092b143470795c8ca869de4654c728fe1":0,"19_225319033-2d3717ad847665de333c85e5239ad4e6a4c0eb95":0,"20_194611324-cdac18519fd14df9ece958cf8e29b846f512656e":0,"21_163752323-cf0096104752607c7374a7f7297139e60b03c59d":0,"22_131014983-21bd6679ce150e193cacd4b1b6585928224f255a":0,"23_103921484-793cfe54cd26e0eb881eec895df41da62a3049ed":0,"24_100734743-9c702922cdcf830cedb92d51e5dc9f956584c3ee":0,"25_090050444-940325042bef787e84917a27f9435d423b3f7f6d":0,"26_122831694-fb7304503f8503597d630855461cab34836897ba":0,"27_105932134-468bfd3487c5fba678bb6455add59e774ffbcd82":0,"28_093420924-3d894d0511bc76c2bd886077d1cb434d878527de":0,"29_123653963-311e12b96201c01d6c66c800d8cfc59ebf9bc4ae":0},"03":{"01_123105394-11b76845228421ea2134c2f0036bcaa498375a7d":0,"02_111316854-6bcea0a38365f518580a4dbbf2f5627bede5aac5":0,"03_123545773-7cafd5f3a924451294a4f2ce6efb628b53fce7eb":0,"04_123048053-de6cbd0e374e3d9209ddf56d1041b83b41efcbe6":0,"05_114049304-757e2037e74fecca521c664fc8486596b306de39":0,"06_132513885-b6cd2155c3442a8c56aa6f6ffa0dc9b6a308a7b1":0,"07_141351695-f69de13bfe1102ff53aa93d40045352441880704":0,"08_144411965-4d93e105bfad79ff6c6f01e4b7c2fdd70caeb43b":0,"09_124257494-e9fa5ae3a1198213f8f58d4b97eb6233c05a28b4":0,"10_094641074-c933cbfd74a8ba3ba18a9aa30a9230bd21c0e4e0":0,"11_132941454-d5674fd482249865abb24d3cbc39215d411cf444":0,"12_121131965-e45874723fa698df5c761b921c29a49c43af1a30":0,"13_122826684-4fedb702b221469a65f0f2bc267ae08c8159e72a":0,"14_120132565-ec204d86b06e4cc9259c1308e365a3e104212a16":0,"15_091934285-86f146a2c0ff08df79fd99efb238e44c75b73381":0,"16_103700755-25cb855b090c29eacebb78e4180c1f3678b7e86a":0,"17_135328724-9b20b5db7b829dff0bcf0383c898c7fc85924369":0,"18_195545045-7a742ec050222dfabfa8fca07167a3b2c680fb3c":0,"19_171551575-ffdf1dec85a61a4a913f83c3970298aac7e05f93":0,"20_172504605-b891e9348b77468623ece665ae6b0a78c9644478":0,"21_151405655-d23eed256b2ba2c594011f6957fbabe2568c8751":0,"22_133032244-ecfb7b0988da93b1b140f7fbe877824296697364":0,"23_134558924-07a1fb953e1ecbd98c93cde96b6b0bca7e3aecbd":0,"24_161910375-f92df338321ac528747ea2374dd72d95bdd1059a":0,"25_134426105-9e3eddc75dde9df9356264b42bd30facb82583cd":0,"26_122057745-f0a33d99ec4656b87bebb97162837047b52eb6f8":0,"27_152647784-1b1c2993a5bc9a64cb4d417509d2fc35a64182f4":0,"28_142615695-cd1db2db48d28db805227e7f6ade79a106d85bc6":0,"29_230220515-768b0f54eb143329743d2696bd36327f1bad7744":0,"31_000351775-accc984ca93a9d002cc61f5960fcfe5902622cb4":0,"31_212132725-8905be2ceea9abead85a5018c09645a3650d7495":0},"04":{"01_184039374-9d82c5501c20bc5346df473563815e95e239c5c6":0,"02_170746385-6baddcfddf8dbaeac02c12efac07189919fbd8dd":0,"03_171037274-8f86986985b161b7fb5aa41283d792417329bc2c":0,"04_155931425-251b08d4e85fce0a9cda6536a112b6153bd56a5a":0,"05_141059494-c452632d3421d6baf26a61e14c21c922bd18175e":0,"06_131752215-78e6d2484fcacdee0cc0a1303e49a5328f3470dd":0,"07_110929974-6ed912dd0319475d2c4ebd9991af52420de17fe8":0,"08_121912145-c849f2d4f8ff19c830b6a97bd6978bf41f878e8b":0,"09_190617045-41b1e87356ec73810d57c37c7058d186f8d574bd":0,"10_212323564-153524300829565b43635efa11a67bde90b99854":0,"12_153527194-8d93df41b0f0ca1824e485bd1612953bdb0bb5ce":0,"13_153128025-a46345d8af634994e51c10f8756148b037cf05b7":0,"14_133156725-f21cf456bf36bd73d8cb6715c745e23efc22a29f":0,"15_130928125-953445873a58513e673f6f05885406394ba66c79":0,"16_122725175-4a6a5c34530e008258c9f603b71504b7ab733292":0,"17_121708894-6bcf96840121f2de61def5ad99700fb7eb6ac905":0,"18_121144215-498628644645d58a9655af71633900dd3ef159cc":0,"19_095816984-a6a15fefb6aea781d3e08f44633cd137ca2c844f":0,"20_092339445-4af059813495e94771017738e7cab32dd97bbc8d":0,"21_152411325-372c7cc3c271c9c3a15118c669e7f72b9c5ea103":0,"22_153645235-ecc18f570967e50a70a8bf12168e668ed7f5967f":0,"23_122508495-1cc1ca429795c45db03e6446005a42fd9b51de15":0,"24_153138585-cd4052c9df0dbb10354f3e3638d9a9a61c2532c6":0,"25_144514765-24a4e6153dae01cc7d5b28a21a105d680e9a5037":0,"26_174018215-53b8133656132b1f899fbf3b8ae6c0c82ae5296b":0,"27_143143135-9f14584f2aa10fe7eb3496f9665f1caf81d23419":0,"28_121011825-039c5e4b893071ab8857794ea421481b87fb31eb":0,"29_144011424-7171d7e41b11dae70424cef169f27ca42ec1b01d":0,"30_124737357-d84f1312915fe45fe0febe888db692c74894c382":0},"05":{"01_130325255-e9518254d79645c3c060ea8d7f4898f8e12af9bb":0,"02_120106734-7c36ec38f16add6ecfc1a3514514b55c5b610434":0,"03_103803444-53eb264cb16f5c1815d4ccfda585b462f9fac92a":0,"04_132112944-c81e5f699e80fa5c0a201ae4c34e455c99e52a20":0,"05_114336234-c17dcb32533aa007dfbf507d22c28ef3c7c11c29":0,"06_133640195-86fdaa745572a3bec4370ac7bd05d18e6bf64c01":0,"07_140849724-e454e9b33f2a3e21d0c36a96d47cf39ce3e42d6c":0,"08_180917553-d005f490a8de7c4136acdb4d1cd1dc2a7b5e3535":0,"09_181506483-94e5b5c77dade0d8f7358c66144b75c369679cab":0,"10_152504864-2fa86b818bb85d0aade89d4dcd4765e439ce7a01":0,"11_124020083-8a6fab02adab2de05f6e864847f96b0924be0840":0,"12_150456404-0ddae48b888838b27a1878e636444e968237e61b":0,"13_134132443-e1b90be3b7c687fcf263db72862b6a199d239f89":0,"14_171304224-241ed44a0b06db45c97681c164fc1098e7c9f0d2":0,"15_222932153-21b5c5f9e0e8d80f23fa258031e9da68e2c25d34":0,"16_201539864-c1ee70ec168eedc3f9d193473d141b9c03e2df88":0,"17_180313633-b3ca8869a6d76de9c7f54bbcf7fbfc8a5b7d2bf4":0,"18_145544494-0e5b975873e88d9276dd8f1e1d94b8f66e741155":0,"19_115823943-fe1b9e09a845e24556f417553b4b434636fdd5ee":0,"20_123414553-81216a349d902dfef94878de75a6fe7ed1c90d1c":0,"21_161401264-a4e273baf43910ba9e5c66949e56b919f8614fb9":0,"22_141456473-51af89fe453738262e2c10c831705a385ec78530":0,"23_111539803-a416692e93054ad66af315f41647d36611e9ad03":0,"24_140721743-dd5f209213a2b75bb386b44c296a059fc10dfb02":0,"25_132811243-c072124814ca45e2f51afe0d5e202b0df6db9b4b":0,"26_105332153-5007611294bfcfe7af8648a69bd19d1b014c84bd":0,"27_140048234-54b36e401d2b72d95e5f1dbbc787f6beed639347":0,"28_111544653-47044a91c6269a395098cf74d4b2a2e70df5c321":0,"29_125736584-c095808e7363f1b6f6d2fbe3e3cd07173d319820":0,"30_111203314-d79c33018606c2deeeb646e1e74ed7fe29737125":0,"31_114156923-df4eda20a008530edaf7f18ff5e472b1f429c867":0},"06":{"01_125357822-77744589f627ad4f21a25a518080d5ac0d604ca1":0,"02_141150883-178efdf5a251ee5342a90ee344b6692eb8aef6e7":0,"03_142215773-673f49ac94f47700a7f8a1af082df6fa57c925ef":0,"04_114137893-a1e5fd2cdf12e819eaa75b195d9729f83c1d88dd":0,"05_093007613-3e2a3007107b7a100794f4e4adbde19263fc7464":0,"06_154550064-f5ed5fe06867884254fd885eca01b6ee5d21ac48":0,"08_111008074-111d1e523d632c489bfe99adfb3f8c080e996d32":0,"10_024502814-362e4a1aec46f386b7bc5a1b3493c690976d9105":0,"11_114525704-db3d6b38b6a20f0caf432077a585bf51af5d06f4":0,"12_105502814-bba9b008ef3095d346ed9a87140c81948476d9db":0,"13_162255214-7b46793eeedd24e576fa1aa7982b436e5cd37edd":0,"14_130009123-e1ad548cd4bfb996ea925584542f30c85aa3dfa1":0,"18_033428364-a4f3206b767bee8ef3e0e1dc8bdbd5e477c5bfa6":0,"19_024747273-ea866dc81b81a71f6ff4c9cb44f8953ce5b398a6":0,"20_021536123-fdf10adef8443c19899c306804cbe585113ff453":0,"21_154449863-64d22c320c67255b42c8185a333a92a499c95820":0,"22_123010423-326a79ebb979de1a952a83c23d37bbdcd6cdc2eb":0,"23_093919743-e202df8e4b1f5aee1c9b04996807bae942723a2f":0,"24_132111533-d8f8723577583d0d3d0239013c6e503c7d4e3abb":0,"25_110741524-e405e82f74babb75600f8f1d94055885968d5701":0,"26_132350504-e18afe45d2bb035434b8aac31375a9a15a605c9e":0,"27_101833734-f63436d190b60e12131036aa9d1888d9023e9127":0,"28_160359224-b327d335ff6bc48c3c2aaedccfa9c40522f6b32f":0,"29_130034493-da8a1ef21b34af25c31cab5cf2cf023b66abe413":0,"30_122358674-c23d2fd3f8a018bcc624f1468a9ce176f6ce93f2":0},"07":{"01_155558464-e2b468eb5cca30640c7811b626a223359e31816c":0,"02_134632394-f06df175b453e397317f32a7785a7b49198f6f06":0,"03_130307163-1dc837ed9a139eaf86d7929e9bee6f0021fc5a3d":0,"04_123425913-bff7de3b43510232f205f11c199ee54cb5b803ec":0,"05_132527306-56dbe466fdbc598baea3bfce289bf52b97b8b8f7":0,"06_142416934-ee3416b055a3d877251c095981508e275d99f8c2":0,"07_114613423-30612316e4af64e530b9b3ecc1cbfc98d11cae3e":0,"08_135019234-b99253cfcfe5e2f4b7f4a947451cb00b877f200b":0}}}}};

      $(document).ready(function() {
        var dtCommitList;
        var dtResultsCompare;
        var dtResultsSingle;
        var dtRuntimes;

        var RE_PATH_HASH = /-([A-Za-z0-9]+)$/;
        (function() {
          var RE_COMMIT = /^(\d{2})_(\d{2})(\d{2})(\d{2})(\d{3})[^-]*-([A-Za-z0-9]+)$/;
          var html = '';
          var yearsObj = index['nodejs~node']['master'];
          var years = Object.keys(yearsObj);
          for (var y = 0; y < years.length; ++y) {
            var year = years[y];
            var monthsObj = yearsObj[year];
            var months = Object.keys(monthsObj);
            for (var m = 0; m < months.length; ++m) {
              var month = months[m];
              var commits = Object.keys(monthsObj[month]);
              for (var c = 0; c < commits.length; ++c) {
                var commit = commits[c];
                var parts = RE_COMMIT.exec(commit);
                var date = parts[1];
                var hour = parts[2];
                var mins = parts[3];
                var secs = parts[4];
                var msecs = parts[5];
                var hash = parts[6];
                var dt = year + '-' + month + '-' + date + ' '
                         + hour + ':' + mins + ':' + secs + '.' + msecs;
                var path = year + '/' + month + '/' + commit;
                html += '<tr data-path="' + path + '"><td>' + dt + '</td><td><a href="https://github.com/nodejs/node/tree/' + hash + '" target="_blank">' + hash + '</a></td><td></td></tr>';
              }
            }
          }
          $('#commit-list tbody').html(html);

          dtCommitList = $('#commit-list').DataTable({
            order: [[ 0, 'desc' ]],
            columnDefs: [{
              targets: -1,
              data: null,
              orderable: false,
              // The "navbar" container here is a hack to workaround a bug with
              // Bootstrap's dropdown being displayed in the wrong position on
              // the page the first time it's shown
              defaultContent: '<div class="navbar">\
                                <div class="btn-group">\
                                  <button type="button" class="btn btn-sm btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\
                                    View ...\
                                  </button>\
                                  <div class="dropdown-menu">\
                                    <button class="dropdown-item" type="button">Runtimes</button>\
                                    <button class="dropdown-item" type="button">All Categories</button>\
                                    <div class="dropdown-divider"></div>\
                                    <h6 class="dropdown-header">Individual Categories</h6>\
                                  </div>\
                                </div>\
                              </div>',
            }],
            select: {
              info: false,
              items: 'row',
              style: 'os'
            }
          });
          dtCommitList.on('select', updateSelection)
                      .on('deselect', updateSelection);
          $('#commit-list tbody').on('click', 'button', function(e) {
            var $this = $(this);
            var $tr = $this.parents('tr');
            var path = $tr.data('path');
            if ($this.hasClass('dropdown-item')) {
              var selectedItem = $(e.target).text();

              $('#loading-modal').modal('show');
              switch (selectedItem) {
                case 'Runtimes':
                  fetchSingleRuntimes(path, function(err, times, total) {
                    $('#loading-modal').modal('hide');
                    if (err)
                      return alert(err.message);

                    $('#results-section').hide();

                    $('#runtime-total').text(total);
                    $('#runtimes').find('thead th:nth-child(2)').text('Time');
                    $('#runtimes-title').html('Run-times for ' + $tr.find('td:nth-child(2)').html());
                    dtRuntimes.clear().rows.add(times).draw();

                    $('#runtimes-section').show();
                  });
                  break;
                case 'All Categories':
                  fetchCategories(path, function(err, categories) {
                    if (err) {
                      $('#loading-modal').modal('hide');
                      return alert(err.message);
                    }

                    var tasks = [];
                    for (var i = 0; i < categories.length; ++i) {
                      tasks.push([
                        fetchSingleResults,
                        [path + '/' + categories[i] + '.json'],
                      ]);
                    }

                    parallel(tasks, function(err, results) {
                      $('#loading-modal').modal('hide');
                      if (err)
                        return alert(err.message);

                      $('#results-title').html('Results for ' + $tr.find('td:nth-child(2)').html());
                      dtResultsSingle.clear();
                      var rows = dtResultsSingle.rows;
                      for (var i = 0; i < results.length; ++i)
                        rows.add(results[i][0]);
                      dtResultsSingle.draw();

                      $('#runtimes-section').hide();
                      $(dtResultsCompare.table().container()).hide();
                      $(dtResultsSingle.table().container()).show();
                      $('#results-section').show();
                    });
                  });
                  break;
                default:
                  fetchSingleResults(path + '/' + selectedItem + '.json', function(err, data) {
                    $('#loading-modal').modal('hide');
                    if (err)
                      return alert(err.message);

                    $('#runtimes-section').hide();
                    $(dtResultsCompare.table().container()).hide();

                    $('#results-title').html('Results for <code>' + selectedItem + '</code> for ' + $tr.find('td:nth-child(2)').html());
                    dtResultsSingle.clear().rows.add(data).draw();

                    $(dtResultsSingle.table().container()).show();
                    $('#results-section').show();
                  });
              }
              return;
            }

            if ($this.data('loaded'))
              return;

            $this.prop('disabled', true);
            $this.text('Loading ...');
            fetchCategories(path, function(err, categories) {
              $this.prop('disabled', false);
              if (err) {
                $this.text('Fetch Metadata');
                alert(err.message);
                return;
              }

              $this.data('loaded', true);
              var $menu = $this.siblings('div.dropdown-menu');
              for (var i = 0; i < categories.length; ++i) {
                $menu.append('<button class="dropdown-item" type="button">'
                               + categories[i] + '</button>');
              }
              $this.dropdown('show');
              $this.text(' View ... ');
            });

            return false;
          });

          dtCommitList.on('user-select', function(e, dt, type, cell, originalEvent) {
            var child = originalEvent.currentTarget.firstElementChild;
            if (child && child.contains(originalEvent.target))
              return false;
          });
          function updateSelection(e, dt, type, ix) {
            var selected = dt.rows({ selected: true });
            switch (selected.count()) {
              case 0:
              case 1:
                btnCompareSel.setAttribute('disabled', '');
                break;
              case 2:
                btnCompareSel.removeAttribute('disabled');
                break;
              default:
                dt.rows(ix).deselect();
            }
          }
        })();

        function getCommonCategories(cb) {
          var selNodes = dtCommitList.rows({ selected: true }).nodes();
          var firstPath = $(selNodes[0]).data('path');
          var secondPath = $(selNodes[1]).data('path');

          parallel([
            [fetchCategories, [firstPath]],
            [fetchCategories, [secondPath]],
          ], function(err, results) {
            if (err)
              return cb(err);

            var firstCategories = results[0][0];
            var secondCategories = results[1][0];
            var categories = [];

            for (var i = 0; i < firstCategories.length; ++i) {
              var category = firstCategories[i];
              if (secondCategories.indexOf(category) !== -1)
                categories.push(category);
            }

            if (categories.length === 0)
              return cb(new Error('Selected commits have no categories in common'));

            cb(null, categories);
          });
        }
        $(btnCompareSel).click(function() {
          var $this = $(this);

          $this.prop('disabled', true);
          $this.text('Loading ...');
          getCommonCategories(function(err, categories) {
            $this.prop('disabled', false);
            $this.text('Compare Selected ...');

            if (err)
              return alert(err.message);

            var $menu = $this.siblings('.dropdown-menu');
            $menu.children('button.dropdown-item').slice(2).remove();

            for (var i = 0; i < categories.length; ++i) {
              $menu.append('<button class="dropdown-item" type="button">'
                           + categories[i] + '</button>');
            }

            requestAnimationFrame(function() {
              $this.dropdown('show');
            });
          });

          return false;
        });
        $(btnCompareSel).siblings('.dropdown-menu').on('click', 'button.dropdown-item', function(e) {
          var $this = $(this);
          var selectedItem = $this.text();
          var selected = dtCommitList.rows({ selected: true });
          var selData = selected.data();
          var oldIdx;
          var newIdx;
          if (selData[0] < selData[1]) {
            oldIdx = 0;
            newIdx = 1;
          } else {
            oldIdx = 1;
            newIdx = 0;
          }
          var selNodes = selected.nodes();
          var $oldRow = $(selNodes[oldIdx]);
          var oldPath = $oldRow.data('path');
          var $newRow = $(selNodes[newIdx]);
          var newPath = $newRow.data('path');

          $('#loading-modal').modal('show');
          switch (selectedItem) {
            case 'Runtimes':
              compareRuntimes(oldPath + '/_metadata.json',
                              newPath + '/_metadata.json',
                              function(err, results) {
                $('#loading-modal').modal('hide');
                if (err)
                  return alert(err.message);

                var diffs = results[0];
                var totalDiff = results[1];

                $('#results-section').hide();

                $('#runtime-total').text(totalDiff).attr('class', (totalDiff[0] === '+' ? 'diff-neg' : 'diff-pos'));
                $('#runtimes').find('thead th:nth-child(2)').text('Difference');
                var $oldHash = $oldRow.find('td:nth-child(2)');
                var $newHash = $newRow.find('td:nth-child(2)');
                var compareLink = 'https://github.com/nodejs/node/compare/'
                                  + $oldHash.text() + '...' + $newHash.text();
                $('#runtimes-title').html('Run-time differences from ' + $oldHash.html() + ' <a href="' + compareLink + '" target="_blank">to</a> ' + $newHash.html());
                dtRuntimes.clear().rows.add(diffs).draw();

                $('#runtimes-section').show();
              });
              break;
            case 'All Categories':
              getCommonCategories(function(err, categories) {
                if (err) {
                  $('#loading-modal').modal('hide');
                  return alert(err.message);
                }

                var tasks = [];
                for (var i = 0; i < categories.length; ++i) {
                  tasks.push([
                    compareResults,
                    [oldPath + '/' + categories[i] + '.json',
                     newPath + '/' + categories[i] + '.json'],
                  ]);
                }

                parallel(tasks, function(err, results) {
                  $('#loading-modal').modal('hide');
                  if (err)
                    return alert(err.message);

                  var $oldHash = $oldRow.find('td:nth-child(2)');
                  var $newHash = $newRow.find('td:nth-child(2)');
                  var compareLink = 'https://github.com/nodejs/node/compare/'
                                    + $oldHash.text() + '...' + $newHash.text();
                  $('#results-title').html('Results from ' + $oldHash.html() + ' <a href="' + compareLink + '" target="_blank">to</a> ' + $newHash.html());
                  dtResultsCompare.clear();
                  var rows = dtResultsCompare.rows;
                  for (var i = 0; i < results.length; ++i)
                    rows.add(results[i][0]);
                  dtResultsCompare.draw();

                  $('#runtimes-section').hide();
                  $(dtResultsSingle.table().container()).hide();
                  $(dtResultsCompare.table().container()).show();
                  $('#results-section').show();
                });
              });
              break;
            default:
              compareResults(oldPath + '/' + selectedItem + '.json',
                             newPath + '/' + selectedItem + '.json',
                             function(err, results) {
                $('#loading-modal').modal('hide');
                if (err)
                  return alert(err.message);

                var $oldHash = $oldRow.find('td:nth-child(2)');
                var $newHash = $newRow.find('td:nth-child(2)');
                var compareLink = 'https://github.com/nodejs/node/compare/'
                                  + $oldHash.text() + '...' + $newHash.text();
                $('#results-title').html('Results for <code>' + selectedItem + '</code> from ' + $oldHash.html() + ' <a href="' + compareLink + '" target="_blank">to</a> ' + $newHash.html());
                dtResultsCompare.clear().rows.add(results).draw();

                $('#runtimes-section').hide();
                $(dtResultsSingle.table().container()).hide();
                $(dtResultsCompare.table().container()).show();
                $('#results-section').show();
              });
          }
        });

        dtResultsCompare = $('#results-compare').DataTable({
          order: [[ 0, 'asc' ], [ 1, 'asc' ], [ 2, 'asc' ]],
          pageLength: 50,
          columnDefs: [{
            targets: 3,
            render: function(data, type, row, meta) {
              switch (type) {
                case 'display':
                case 'filter':
                  data = '';
                  break;
              }
              return data;
            },
            createdCell: function(td, cellData, rowData, row, col) {
              switch (cellData) {
                case -1:
                  $(td).addClass('confNA');
                  break;
                case 1:
                case 2:
                case 3:
                  $(td).addClass('conf' + cellData);
                  break;
              }
            },
          }, {
            targets: 4,
            render: function(data, type, row, meta) {
              switch (type) {
                case 'display':
                case 'filter':
                  data = data.toFixed(2) + ' %';
                  if (data[0] !== '-')
                    data = '+' + data;
                  break;
              }
              return data;
            },
            createdCell: function(td, cellData, rowData, row, col) {
              $(td).addClass(cellData < 0 ? 'diff-neg' : 'diff-pos');
            },
          }],
        });

        dtResultsSingle = $('#results-single').DataTable({
          order: [[ 0, 'asc' ], [ 1, 'asc' ], [ 2, 'asc' ]],
          pageLength: 50,
          columnDefs: [{
            targets: -1,
            type: 'num',
          }],
        });

        dtRuntimes = $('#runtimes').DataTable({
          order: [[ 0, 'asc' ]],
          pageLength: 50,
          columnDefs: [{
            targets: -1,
            createdCell: function(td, cellData, rowData, row, col) {
              if (typeof cellData !== 'string' || !cellData)
                return;
              switch (cellData[0]) {
                case '+':
                  $(td).addClass('diff-neg');
                  break;
                case '-':
                  $(td).addClass('diff-pos');
                  break;
              }
            },
          }],
        });

        $('#loading-modal').modal();
      });
    </script>
    <style>
      body {
        padding: 10px;
      }

      #results-section,
      #runtimes-section {
        display: none;
      }

      table#commit-list tbody tr td,
      table#runtimes tbody tr td:nth-child(2),
      table#results-compare tbody tr td:nth-child(5) {
        font-family: monospace;
        font-size: 1.3rem;
      }
      table#commit-list tbody tr td:nth-child(2),
      table#runtimes tbody tr td:nth-child(2),
      table#results-compare tbody tr td:nth-child(4),
      table#results-compare tbody tr td:nth-child(5) {
        font-weight: bold;
      }
      table#results-compare tbody tr td:nth-child(5) {
        text-align: right
      }
      table#results-compare tbody tr td:nth-child(4) {
        text-align: right;
        width: 100px;
        vertical-align: middle;
        line-height: 1rem;
        color: black;
        font-size: 2.3rem;
      }
      td.confNA {
        background-color: #666;
      }
      td.conf1:before {
        content: '•'
      }
      td.conf2:before {
        content: '••'
      }
      td.conf3:before {
        content: '•••'
      }
      .diff-pos {
        background-color: darkgreen;
        color: white;
      }
      .diff-neg {
        background-color: darkred;
        color: white;
      }
      table.dataTable.order-column tbody tr > .sorting_1,
      table.dataTable.order-column tbody tr > .sorting_2,
      table.dataTable.order-column tbody tr > .sorting_3,
      table.dataTable.order-column tbody tr > .sorting_4 {
        background-color: #ccc;/*#f9f9f9;*/
      }
      hr {
        border-top: 1px solid black;
      }
      #runtime-total {
        display: inline-block;
        font-family: monospace;
        font-weight: bold;
        font-size: 1.2rem;
        padding: 5px;
        vertical-align: middle;
      }
      #runtime-total-info {
        display: inline-block;
        font-weight: bold;
        border: 1px solid gray;
        padding: 10px;
        margin-bottom: 5px;
      }
      table tbody tr td {
        vertical-align: middle !important;
      }
      #loading-modal .modal-content {
        padding: 10px;
        text-align: center;
        font-size: 2rem;
      }
    </style>
  </head>
  <body>
    <h1>Available Commits</h1>
    <div style="margin-bottom: 10px">
      <div class="btn-group">
        <button type="button" id="btnCompareSel" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" disabled>
          Compare Selected ...
        </button>
        <div class="dropdown-menu">
          <button class="dropdown-item" type="button">Runtimes</button>
          <button class="dropdown-item" type="button">All Categories</button>
          <div class="dropdown-divider"></div>
          <h6 class="dropdown-header">Individual Categories</h6>
        </div>
      </div>
    </div>
    <table id="commit-list" class="table table-bordered table-hover table-sm compact">
      <thead>
        <tr>
          <th>Build Date/Time (EST)</th>
          <th>Commit</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <div id="results-section">
      <hr />
      <h1 id="results-title">Results</h1>
      <table id="results-compare" class="table table-bordered table-hover table-sm compact">
        <thead>
          <tr>
            <th>Category</th>
            <th>Benchmark</th>
            <th>Configuration</th>
            <th>Confidence</th>
            <th>Difference</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
      <table id="results-single" class="table table-bordered table-hover table-sm compact">
        <thead>
          <tr>
            <th>Category</th>
            <th>Benchmark</th>
            <th>Configuration</th>
            <th>Average</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
    <div id="runtimes-section">
      <hr />
      <h1 id="runtimes-title">Run-times</h1>
      <div id="runtime-total-info">Total: <div id="runtime-total"></div></div>
      <table id="runtimes" class="table table-bordered table-hover table-sm compact">
        <thead>
          <tr>
            <th>Category</th>
            <th>Time/Difference</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
    <div id="loading-modal" class="modal" data-backdrop="static" data-keyboard="false" data-show="false">
      <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
          Loading ...
        </div>
      </div>
    </div>
  </body>
</html>
